(window.MIP=window.MIP||[]).push({name:"mip-app-banner",func:function(){define("mip-app-banner/mip-app-banner",["require","customElement","fetch-jsonp","viewer","util"],function(n){function e(n){}var i=n("customElement").create(),t=n("fetch-jsonp"),a=n("viewer"),o=n("util"),r=o.platform;return i.prototype.jumpToLink=function(n,i){var t=setTimeout(function(){window.top.location.href=i,e("页面失焦1，猜测调起成功"),clearTimeout(t)},2500);window.open(n,"_top");var a=function(){e("页面失焦2，猜测调起成功"),(document.hidden||document.webkitHidden)&&clearTimeout(t)};document.addEventListener("visibilitychange",a,!1),document.addEventListener("webkitvisibilitychange",a,!1),window.addEventListener("pagehide",function(){e("页面失焦3，猜测调起成功"),clearTimeout(t)},!1)},i.prototype.hasSystemBanner=function(){var n=r.isSafari();if(!a.isIframed&&n&&this.opt.iosMetaTag)return e("safari 系统默认显示下载"),!0;else return e("无原生默认banner, 显示app-banner"),!1},i.prototype.initIosBanner=function(){var n="",i="";if(r.isWechatApp()){var t=this.opt.wechatOpenSafari,a=this.opt.wechatIosYyb;e("ios 在微信中"),n=t||a}else{var o=this.opt.iosMetaTag&&this.opt.iosMetaTag.getAttribute("content"),p=o.replace(/\s/,"").split(","),s={};p.forEach(function(n){var e=n.split("=");s[e[0]]=e[1]});var n=r.getOsVersion()>="9"?this.opt.iosUniversalLink:"";if(!n){var d=s["app-argument"];if(d)n=d}i="https://itunes.apple.com/cn/app/id"+s["app-id"]}var c=this;this.element.querySelector("[open-button]").addEventListener("click",function(){c.jumpToLink(n,i)}),e("ios openInAppUrl："+n),e("ios iosInstallUrl: "+i)},i.prototype.initAndroidBanner=function(){var n="",i="",a=this;if(r.isWechatApp()){var o=this.opt.wechatAndroidYyb;e("安卓：在微信中"),n=o}else{new Promise(function(o,r){if(!a.opt.androidManifest)return void r("manifest 不存在");var p=a.opt.androidManifest.getAttribute("href");if(/http:\/\//.test(p))return void r("manifest必须是https的连接");t(p).then(function(n){return n.json()}).then(function(t){var a=t.related_applications;if(!a)return void r("manifest 不合法，无 related_applications");for(var p=0;p<a.length;p++){var s=a[p];if("play"===s.platform||"mip-app-banner"===s.platform)i=s.install,n=s.open,o(),e("manifest 获取跳转链接完成")}},function(){r("manifest.json 数据格式不合法")})}).then(function(){},function(n){console.warn("mip-app-banner解析manifest失败："+n)}).finally(function(){e("manifestPromise 在finall中");var t=r.isChrome()&&navigator.userAgent.match(/Chrome\/(\d+)/)[1]>25&&a.opt.androidChromeIntent,o=navigator.userAgent.match(/Android ([\d.]+)/)&&navigator.userAgent.match(/Android ([\d.]+)/)[1]>="6.0"&&a.opt.androidAppLink;if(t)n=a.opt.androidChromeIntent;else if(o)n=a.opt.androidAppLink;else n=a.opt.androidScheme;if(!i)i=a.opt.androidDownload;a.element.querySelector("[open-button]").addEventListener("click",function(){a.jumpToLink(n,i)}),e("android openInAppUrl："+n),e("android androidInstallUrl: "+i)})}},i.prototype.firstInviewCallback=function(){var n,i=this.element,t=i.querySelector('script[type="application/json"]'),a=t?t.innerHTML:"";try{n=JSON.parse(a)}catch(n){return void console.warn("<mip-app-banner>配置不是合法JSON, "+n.message)}if(this.opt={iosMetaTag:document.head.querySelector('meta[name="apple-itunes-app"]'),iosUniversalLink:n&&n["ios-universal-link"],androidManifest:document.head.querySelector('link[rel="manifest"]'),androidScheme:n&&n["android-scheme"],androidDownload:n&&n["android-download"],androidAppLink:n&&n["android-app-link"],androidChromeIntent:n&&n["android-chrome-intent"],wechatOpenSafari:n&&n["wechat-open-safari"],wechatIosYyb:n&&n["wechat-ios-yyb"],wechatAndroidYyb:n&&n["wechat-android-yyb"]},console.log(this.opt),this.hasSystemBanner())return e("存在原生 banner，移除组件"),void this.element.remove();if(r.isIos())this.initIosBanner(),e("初始化ios banner");else if(r.isAndroid())this.initAndroidBanner(),e("初始化安卓 banner");o.css(i,{display:"",visibility:"visible"}),e("banner 初始化完成，显示给用户")},i}),define("mip-app-banner",["mip-app-banner/mip-app-banner"],function(n){return n}),function(){function n(n,e){n.registerMipElement("mip-app-banner",e,"mip-app-banner{width:100%;display:block;box-sizing:border-box;background:#fff;z-index:13 !important}[open-button]{display:block}")}if(window.MIP)require(["mip-app-banner"],function(e){n(window.MIP,e)});else require(["mip","mip-app-banner"],n)}()}});