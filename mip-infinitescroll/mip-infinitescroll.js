(window.MIP=window.MIP||[]).push({name:"mip-infinitescroll",func:function(){define("mip-infinitescroll/infinitescroll",["require","jquery"],function(t){var o=t("jquery"),e=function(t){if(t.$result&&t.$loading&&t.pushResult){var e=this;t.$result=o(t.$result),t.$loading=o(t.$loading),e.options=o.extend({$wrapper:o(window),$scroller:o("body"),firstResult:[],scrollPageClass:"mip-infinitescroll-page",loadingHtml:"加载中...",loadFailHtml:"加载失败,点击重试",loadOverHtml:"加载完毕",bufferHeightPx:10,pageResultNum:10,limitShowPn:2,preLoadPn:1},t),e._init()}};return e.prototype={version:"0.1.0",_init:function(){var t=this;if(t.eventSpace=".InfiniteScroll",t.state="start",t.scrollPageCache={topPosition:[],content:[]},t.dataStatus=1,t.currentLoadPage=t.options.firstResult.length?0:-1,t.currentShowPage=0,t._horizontalHack(),t.options.$loading.html(t.options.loadingHtml),t.options.firstResult.length)t.scrollPageCache.content=t.scrollPageCache.content.concat(t._separatePage(t.options.firstResult)),t.options.$result.html(t._wrapPageParentDom(t.scrollPageCache.content[0],0)),t.scrollPageCache.topPosition.push(t.options.$result.position().top);if(t.refresh(),o(window).on("resize"+t.eventSpace,function(){t.refresh()}),t._bindScroll(),!t.options.firstResult.length)t._scrollBottomFn()},refresh:function(){var t=this;if("pause"!==t.state)t.wrapperHeight=t.options.$wrapper.height(),t.scrollerHeight=t.options.$scroller.height(),t.currentScrollTop=t.options.$wrapper.scrollTop()},destroy:function(){var t=this;o(window).off("resize"+t.eventSpace),t.options.$wrapper.off("scroll"+t.eventSpace),t.options.$loading.off("click"+t.eventSpace),t.scrollPageCache=null},pause:function(){var t=this;if("pause"!==t.state)t.pauseScrollTop=t.currentScrollTop,t.state="pause"},start:function(){var t=this;if("start"!==t.state)t.options.$wrapper.scrollTop(t.pauseScrollTop),t.refresh(),t.state="start"},_horizontalHack:function(){var t,e=this;if(void 0!==window.orientation){if(0===window.orientation||180===window.orientation)t=Math.min(window.screen.width,o(window).width());else if(90===window.orientation||-90===window.orientation)t=Math.min(window.screen.width,window.screen.height),t=t*o(window).width()/Math.max(window.screen.width,window.screen.height)}else t=Math.min(window.screen.width,window.screen.height);e.options.$result.css({"max-width":t+"px"})},_bindScroll:function(){var t=this;if(t.options.$wrapper.on("scroll"+t.eventSpace,function(){if("pause"!==t.state){if(t.currentScrollTop=o(this).scrollTop(),t.wrapperHeight=t.options.$wrapper.height(),t.currentScrollTop<=0)t.options.onScrollTop&&t.options.onScrollTop.call(t);if(t.currentScrollTop>=t.scrollerHeight-t.wrapperHeight-t.options.bufferHeightPx)t._scrollBottomFn(),t.options.onScrollBottom&&t.options.onScrollBottom.call(t);var e=t.getShowPage();if(t.currentShowPage!==e)if(t.options.onChangeShowPN&&t.options.onChangeShowPN.call(t,e,t.currentShowPage),t.currentShowPage=e,t.options.limitShowPn)t._cycleScrollElement(e)}}),t.currentScrollTop>=t.scrollerHeight-t.wrapperHeight-t.options.bufferHeightPx)t.options.$wrapper.trigger("scroll")},_scrollBottomFn:function(){var t=this,e=t.currentLoadPage+1,n=t.scrollPageCache.content.length-1;if(e<=n)t._updateScrollElement(e),t.options.onLoadNewPage&&t.options.onLoadNewPage.call(t,e);if(1===t.dataStatus&&e+t.options.preLoadPn>=n){var i=t.options.pushResult.call(t,(n+1)*t.options.pageResultNum,n-e);t.dataStatus=2,o.when(i).then(function(o){if(0==o||"NULL"===o)t.dataStatus=0,t.options.$loading.html(t.options.loadOverHtml);else if(o.length)t.dataStatus=1,t.scrollPageCache.content=t.scrollPageCache.content.concat(t._separatePage(o)),t.options.$wrapper.trigger("scroll")},function(){t.dataStatus=3,t.options.$loading.html(t.options.loadFailHtml).one("click"+t.eventSpace,function(){t.dataStatus=1,t.options.$loading.html(t.options.loadingHtml),t.options.$wrapper.trigger("scroll")})})}},_updateScrollElement:function(t){var e=this,n=o(e._wrapPageParentDom(e.scrollPageCache.content[t],t));e.options.$result.append(n),e.currentLoadPage=t,e.scrollerHeight=e.options.$scroller.height(),e.scrollPageCache.topPosition.push(n.position().top)},_cycleScrollElement:function(t){var e=this,n="infinite-recycle",i=Math.max(t-Math.floor((e.options.limitShowPn-1)/2),0),r=e.options.$result.find("."+e.options.scrollPageClass),l=r.slice(i,i+e.options.limitShowPn);if(l.length)l.each(function(){if(o(this).hasClass(n))o(this).html(e.scrollPageCache.content[o(this).attr("data-page")]),o(this).removeClass(n)}),r.not(l).not("."+n).each(function(){o(this).height(o(this).height()).empty(),o(this).addClass(n)}),e.scrollerHeight=e.options.$scroller.height()},_separatePage:function(t){var o=this;if(t.length&&"NULL"!==t){for(var e=o.options.pageResultNum,n=Math.ceil(t.length/e),i=[],r=0;r<n;r++)i.push(t.slice(r*e,r*e+e).join(""));return i}},_wrapPageParentDom:function(t,o){return['<ul class="'+this.options.scrollPageClass+'" data-page="'+o+'">',t,"</ul>"].join("")},getShowPage:function(){for(var t=this,o=t.scrollPageCache.topPosition.concat(),e=o.length-1;e>=0;e--)if(t.currentScrollTop>=o[e])return e;return 0},constructor:e},e}),define("mip-infinitescroll/mip-infinitescroll",["require","util","templates","fetch-jsonp","customElement","./infinitescroll"],function(t){function o(t){var o=this,e=t;if(t.indexOf("?")>0)e+="?"===t[t.length-1]?"":"&",e+=o.params.pnName+"="+o.params.pn;else e+="?"+o.params.pnName+"="+o.params.pn;return e}var e=t("util"),n=t("templates"),i=t("fetch-jsonp"),r=t("customElement").create(),l=t("./infinitescroll"),a=null;return r.prototype.firstInviewCallback=function(){var t=this,r=t.element,s=r.getAttribute("data-src")||"";if(!s)return console.error("未填写src字段，不能获取数据"),void r.remove();t.params={rn:20,prn:6,pn:1,pnName:"pn",bufferHeightPx:10,loadingHtml:"加载中...",loadFailHtml:"加载失败",loadOverHtml:"加载完毕!",timeout:5e3};try{var c=r.querySelector('script[type="application/json"]');if(c)t.params=e.fn.extend(t.params,JSON.parse(c.textContent.toString())),t.params.rn="Infinity"===t.params.rn?1/0:t.params.rn}catch(t){return console.warn("json is illegal"),void console.warn(t)}t.url=o.call(t,s),t.pushResult=function(e,r){var l=$.Deferred();if(e>t.rn)l.resolve("NULL");else i(t.url,{jsonpCallback:"callback",timeout:t.timeout}).then(function(t){return t.json()}).then(function(i){if(i&&0===parseInt(i.status,10)&&i.data){if(e>t.params.rn||!i.data.items)l.resolve("NULL");n.render(t.element,i.data.items).then(function(t){l.resolve(t)}),t.params.pn++,t.url=o.call(t,s)}else l.resolve("NULL")},function(t){l.reject()});return l.promise()},a=new l({$result:r.querySelector(".mip-infinitescroll-results"),$loading:r.querySelector(".mip-infinitescroll-loading"),loadingHtml:t.params.loadingHtml,loadFailHtml:t.params.loadFailHtml,loadOverHtml:t.params.loadOverHtml,bufferHeightPx:t.params.bufferHeightPx,pageResultNum:t.params.prn,limitShowPn:0,preLoadPn:2,firstResult:[],pushResult:t.pushResult})},r.prototype.detachedCallback=function(){a=null},r}),define("mip-infinitescroll",["mip-infinitescroll/mip-infinitescroll"],function(t){return t}),function(){function t(t,o){t.registerMipElement("mip-infinitescroll",o)}if(window.MIP)require(["mip-infinitescroll"],function(o){t(window.MIP,o)});else require(["mip","mip-infinitescroll"],t)}()}});